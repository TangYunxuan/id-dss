import{d as ce,u as de,r as d,g as R,i as ue,f as ve,w as pe,c as o,a as e,j as b,t as l,p as g,F as T,m as P,k as q,v as G,e as J,o as i,q as B}from"./index-BIMWRJSL.js";import{g as me,u as Y,a as be,b as K}from"./api-CxRqiZlS.js";import{s as _}from"./text-B6rfVV0Y.js";const fe={class:"animate-fade-in"},xe={key:0,class:"mb-6 p-4 rounded-lg bg-amber-50 border border-amber-200"},ge={class:"flex items-start gap-3"},ye={class:"text-sm text-amber-700 mt-1"},_e={class:"card p-6 mb-6"},he={class:"grid sm:grid-cols-3 gap-4 mb-6"},ke={class:"font-medium text-surface-900"},we={class:"font-medium text-surface-900 capitalize"},je={class:"font-medium text-surface-900 capitalize"},Ce={class:"flex items-center justify-between gap-3 mb-2"},Ae=["disabled"],Oe={class:"space-y-3"},Me={key:0,class:"bg-surface-50 rounded-lg p-4 text-sm text-surface-500 italic"},Se={class:"mt-2 w-6 text-xs text-surface-500 text-right flex-shrink-0"},Ie=["onUpdate:modelValue"],Be=["onClick"],Le={class:"flex flex-wrap items-center gap-2"},ze={key:1,class:"bg-surface-50 border border-surface-200 rounded-lg p-4"},Ne={class:"card p-6 mb-6"},Ve={class:"flex items-center justify-between mb-6"},Re=["disabled"],Te={key:0,class:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24"},Pe={key:1,class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},$e={key:0,class:"mb-6 p-4 rounded-lg bg-red-50 border border-red-200 text-red-700 text-sm"},Fe={key:1,class:"mb-6 p-4 rounded-lg bg-emerald-50 border border-emerald-200 text-emerald-800 text-sm"},He={key:2,class:"space-y-6 animate-slide-up"},De={class:"bg-brand-50 border border-brand-200 rounded-lg p-4"},Ue={class:"flex items-start gap-3"},Ee={class:"text-sm text-brand-800"},qe={key:0},Ge={class:"space-y-3"},Je={class:"flex items-start justify-between gap-4 mb-2"},Ye={class:"text-sm text-surface-900 font-medium"},Ke={class:"flex items-center gap-2 flex-shrink-0"},Qe={class:"badge badge-brand"},We={class:"text-sm text-surface-600"},Xe={key:1},Ze={class:"space-y-2"},et={class:"w-6 h-6 rounded-full bg-emerald-200 text-emerald-700 flex items-center justify-center flex-shrink-0 text-xs font-medium"},tt={class:"flex-1 min-w-0"},st={class:"text-sm text-surface-800"},at={class:"flex items-center gap-2 flex-shrink-0"},nt=["disabled","onClick"],ot=["disabled","onClick"],it=["onClick"],lt={key:2,class:"p-4 bg-surface-50 rounded-lg"},rt={class:"text-sm text-surface-600"},ct={key:3,class:"text-center py-8 text-surface-500"},dt={class:"flex justify-between"},bt=ce({__name:"ObjectiveAnalysisView",setup(ut){const L=ve(),r=de(),h=d(!1),k=d(null),f=d(null),w=d(null),z=d(null),x=d(""),u=d([]),A=d(""),$=d(!1),v=d(""),O=d(!1);function F(s){return(s||"").replace(/^\s*(?:[-*•]|\d+\.)\s+/,"").trim()}function M(s){const t=(s||"").replace(/\r\n/g,`
`).trim();return t?t.split(`
`).map(F).filter(Boolean):[]}function Q(s){return(s||[]).map(F).filter(Boolean).join(`
`)}const p=R(()=>Q(u.value)),j=d(!1),S=d("");function W(){u.value.push("")}function X(s){u.value.splice(s,1)}function Z(){const s=M(S.value);s.length!==0&&(u.value=[...u.value,...s],S.value="",j.value=!1)}const y=d([]),ee=R(()=>p.value.trim().length>0),H=R(()=>(p.value||"")!==(A.value||""));ue(async()=>{if(!r.hasActiveSession){L.push("/new-session");return}try{k.value=await me()}catch(s){console.error("Failed to get LLM status:",s)}}),pe(()=>r.courseContext.learning_objectives,s=>{const t=s||"";if(!$.value){u.value=M(t),A.value=t,$.value=!0;return}H.value||(u.value=M(t))},{immediate:!0});async function te(){var s,t;if(r.sessionId){h.value=!0,x.value="",v.value="";try{r.updateLearningObjectives(p.value);try{await Y(r.sessionId,{learning_objectives:p.value}),A.value=p.value}catch(c){console.warn("Failed to persist objectives before analysis:",c)}const a=await be(r.sessionId,p.value);w.value=a.step_id,z.value=a.recommendation_id,f.value=a.data,y.value=(f.value.improved_objectives||[]).map((c,I)=>({id:`objective-${I}`,text:_(c||"").trim(),status:"pending"})),r.addDesignStep({id:a.step_id,session_id:r.sessionId,phase:"objective-analysis",user_input:p.value,created_at:new Date().toISOString()})}catch(a){if(console.error("Analysis failed:",a),a&&typeof a=="object"&&"response"in a){const c=a;x.value=((t=(s=c.response)==null?void 0:s.data)==null?void 0:t.detail)||"Analysis failed. Please try again."}else x.value="Analysis failed. Please try again."}finally{h.value=!1}}}async function D(s,t){const a=_(s);try{await navigator.clipboard.writeText(a),v.value=t}catch(c){console.warn("Failed to copy to clipboard:",c),v.value="Could not access clipboard. Please copy manually."}}function N(){return y.value.filter(s=>s.status==="accepted").map(s=>_(s.text||"").trim()).filter(Boolean)}async function U(s,t,a){if(w.value)try{await K({step_id:w.value,recommendation_id:z.value??void 0,action_type:t,edited_content:a?JSON.stringify(a):void 0,comment:s})}catch(c){console.warn("Failed to record objective action:",c)}}async function se(s){const t=y.value.find(a=>a.id===s);t&&(t.status="accepted",await U(s,"accept",{id:s,text:t.text}))}async function ae(s){const t=y.value.find(a=>a.id===s);t&&(t.status="rejected",await U(s,"reject"))}async function ne(){const s=N();if(s.length===0){v.value="No accepted objectives yet.";return}const t=s.join(`
`);v.value="Applied accepted objectives. You can edit further and re-run analysis.",await V(t,"Replaced objectives with accepted improved objectives")}async function oe(){const s=N();if(s.length===0){v.value="No accepted objectives yet.";return}const t=p.value.trim(),a=s.join(`
`),c=t?`${t}

${a}`:a;v.value="Appended accepted objectives below your existing objectives.",await V(c,"Inserted accepted improved objectives below existing objectives")}async function ie(){const s=N();if(s.length===0){v.value="No accepted objectives yet.";return}await D(s.join(`
`),"Copied accepted objectives to clipboard (cleaned markdown).")}async function V(s,t){if(r.updateLearningObjectives(s),u.value=M(s),r.sessionId){const a=await Y(r.sessionId,{learning_objectives:s});A.value=a.learning_objectives??s}if(w.value)try{await K({step_id:w.value,recommendation_id:z.value??void 0,action_type:"edit",edited_content:s,comment:t})}catch(a){console.warn("Failed to record user action:",a)}}async function le(){if(r.sessionId){O.value=!0,x.value="",v.value="";try{const s=p.value;await V(s,"Saved objectives edits"),v.value="Saved."}catch(s){console.warn("Failed to save objectives:",s),x.value="Save failed. Please try again."}finally{O.value=!1}}}function re(){r.setCurrentPhase("activity-suggestion"),L.push("/activity-suggestion")}return(s,t)=>{var a,c,I,E;return i(),o("div",fe,[t[23]||(t[23]=e("div",{class:"mb-8"},[e("h1",{class:"text-2xl font-bold text-surface-900 mb-2"},"Objective Analysis"),e("p",{class:"text-surface-600"}," Review your learning objectives and get AI-powered analysis and suggestions. ")],-1)),k.value&&!k.value.configured?(i(),o("div",xe,[e("div",ge,[t[4]||(t[4]=e("svg",{class:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("div",null,[t[3]||(t[3]=e("div",{class:"font-medium text-amber-800"},"LLM Not Configured",-1)),e("p",ye,l(k.value.message),1)])])])):b("",!0),e("div",_e,[t[11]||(t[11]=e("h2",{class:"text-sm font-semibold text-surface-500 uppercase tracking-wider mb-4"},"Session Context",-1)),e("div",he,[e("div",null,[t[5]||(t[5]=e("div",{class:"text-xs text-surface-500 mb-1"},"Course",-1)),e("div",ke,l(g(r).courseContext.course_title),1)]),e("div",null,[t[6]||(t[6]=e("div",{class:"text-xs text-surface-500 mb-1"},"Level",-1)),e("div",we,l((a=g(r).courseContext.level)==null?void 0:a.replace("-"," ")),1)]),e("div",null,[t[7]||(t[7]=e("div",{class:"text-xs text-surface-500 mb-1"},"Modality",-1)),e("div",je,l((c=g(r).courseContext.modality)==null?void 0:c.replace("-"," ")),1)])]),e("div",null,[e("div",Ce,[t[8]||(t[8]=e("div",{class:"text-xs text-surface-500"},"Learning Objectives (editable)",-1)),e("button",{class:"btn-secondary",disabled:!g(r).sessionId||O.value||!H.value,onClick:le},[e("span",null,l(O.value?"Saving...":"Save"),1)],8,Ae)]),e("div",Oe,[u.value.length===0?(i(),o("div",Me," No objectives yet. Add one below, or paste multiple at once. ")):b("",!0),(i(!0),o(T,null,P(u.value,(n,m)=>(i(),o("div",{key:m,class:"flex items-start gap-2"},[e("div",Se,l(m+1)+".",1),q(e("input",{"onUpdate:modelValue":C=>u.value[m]=C,type:"text",class:"w-full bg-surface-50 rounded-lg px-3 py-2 text-sm text-surface-700 border border-surface-200 focus:outline-none focus:ring-2 focus:ring-brand-200 focus:border-brand-300",placeholder:"e.g., Students will be able to explain..."},null,8,Ie),[[G,u.value[m]]]),e("button",{type:"button",class:"btn-ghost text-sm px-3 py-2 flex-shrink-0",onClick:C=>X(m),title:"Remove"}," Remove ",8,Be)]))),128)),e("div",Le,[e("button",{type:"button",class:"btn-secondary",onClick:W}," + Add objective "),e("button",{type:"button",class:"btn-ghost",onClick:t[0]||(t[0]=n=>j.value=!j.value)},l(j.value?"Hide paste box":"Paste multiple"),1)]),j.value?(i(),o("div",ze,[t[9]||(t[9]=e("div",{class:"text-xs text-surface-500 mb-2"},"Paste objectives (one per line)",-1)),q(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=n=>S.value=n),class:"w-full bg-white rounded-lg p-3 text-sm text-surface-700 border border-surface-200 focus:outline-none focus:ring-2 focus:ring-brand-200 focus:border-brand-300",rows:"4",placeholder:`• Objective 1
• Objective 2
• Objective 3`},null,512),[[G,S.value]]),e("div",{class:"flex justify-end mt-3"},[e("button",{type:"button",class:"btn-primary",onClick:Z}," Add to list ")])])):b("",!0)]),t[10]||(t[10]=e("p",{class:"text-xs text-surface-500 mt-2"}," Tip: after you get “Suggested Improvements”, you can apply them back into this box and re-run analysis. ",-1))])]),e("div",Ne,[e("div",Ve,[t[14]||(t[14]=e("div",null,[e("h2",{class:"font-semibold text-surface-900"},"AI Objective Analysis"),e("p",{class:"text-sm text-surface-500 mt-1"}," Get feedback on objective clarity, alignment with Bloom's taxonomy, and improvement suggestions. ")],-1)),e("button",{onClick:te,disabled:h.value||!ee.value||((I=k.value)==null?void 0:I.configured)===!1,class:"btn-primary"},[h.value?(i(),o("svg",Te,[...t[12]||(t[12]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(i(),o("svg",Pe,[...t[13]||(t[13]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"},null,-1)])])),e("span",null,l(h.value?"Analyzing...":"Run Objective Analysis (AI)"),1)],8,Re)]),x.value?(i(),o("div",$e,l(x.value),1)):b("",!0),v.value?(i(),o("div",Fe,l(v.value),1)):b("",!0),f.value?(i(),o("div",He,[e("div",De,[e("div",Ue,[t[16]||(t[16]=e("div",{class:"w-8 h-8 rounded-full bg-brand-100 text-brand-600 flex items-center justify-center flex-shrink-0"},[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})])],-1)),e("div",null,[t[15]||(t[15]=e("div",{class:"font-medium text-brand-900 mb-1"},"Overall Assessment",-1)),e("p",Ee,l(g(_)(f.value.overall_assessment||"")),1)])])]),(E=f.value.bloom_analysis)!=null&&E.length?(i(),o("div",qe,[t[17]||(t[17]=e("div",{class:"text-sm font-medium text-surface-700 mb-3"},"Bloom's Taxonomy Analysis",-1)),e("div",Ge,[(i(!0),o(T,null,P(f.value.bloom_analysis,(n,m)=>(i(),o("div",{key:m,class:"p-4 bg-surface-50 rounded-lg"},[e("div",Je,[e("p",Ye,l(n.objective),1),e("div",Ke,[e("span",Qe,l(n.current_level),1),e("span",{class:B(["badge",n.is_measurable?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"])},l(n.is_measurable?"Measurable":"Not Measurable"),3)])]),e("p",We,l(g(_)(n.suggestion||"")),1)]))),128))])])):b("",!0),y.value.length?(i(),o("div",Xe,[e("div",{class:"flex items-center justify-between gap-4 mb-3"},[t[18]||(t[18]=e("div",{class:"text-sm font-medium text-surface-700"},"Suggested Improvements",-1)),e("div",{class:"flex items-center gap-2"},[e("button",{class:"btn-secondary",onClick:ie}," Copy accepted "),e("button",{class:"btn-secondary",onClick:oe}," Insert accepted "),e("button",{class:"btn-primary",onClick:ne}," Apply accepted ")])]),e("ul",Ze,[(i(!0),o(T,null,P(y.value,(n,m)=>(i(),o("li",{key:n.id,class:B(["flex items-start gap-3 p-3 rounded-lg border",{"bg-emerald-50 border-emerald-200":n.status==="accepted","bg-red-50 border-red-200 opacity-70":n.status==="rejected","bg-surface-50 border-surface-200":n.status==="pending"}])},[e("span",et,l(m+1),1),e("div",tt,[e("span",st,l(n.text),1)]),e("div",at,[e("button",{class:B(["btn-success text-sm px-3 py-1.5",{"opacity-50 cursor-not-allowed":n.status==="accepted"}]),disabled:n.status==="accepted",onClick:C=>se(n.id)}," Accept ",10,nt),e("button",{class:B(["btn-danger text-sm px-3 py-1.5",{"opacity-50 cursor-not-allowed":n.status==="rejected"}]),disabled:n.status==="rejected",onClick:C=>ae(n.id)}," Reject ",10,ot),e("button",{class:"btn-ghost text-sm px-3 py-1.5",onClick:C=>D(n.text,"Copied this suggestion (cleaned markdown)."),title:"Copy this suggestion"}," Copy ",8,it)])],2))),128))])])):b("",!0),f.value.alignment_notes?(i(),o("div",lt,[t[19]||(t[19]=e("div",{class:"text-sm font-medium text-surface-700 mb-2"},"Alignment Notes",-1)),e("p",rt,l(g(_)(f.value.alignment_notes||"")),1)])):b("",!0)])):x.value?b("",!0):(i(),o("div",ct,[...t[20]||(t[20]=[e("svg",{class:"w-12 h-12 mx-auto mb-3 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})],-1),e("p",{class:"text-sm"},'Click "Run Objective Analysis" to get AI-powered feedback.',-1)])]))]),e("div",dt,[e("button",{onClick:t[2]||(t[2]=n=>g(L).push("/new-session")),class:"btn-secondary"},[...t[21]||(t[21]=[e("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 17l-5-5m0 0l5-5m-5 5h12"})],-1),J(" Back to Context ",-1)])]),e("button",{onClick:re,class:"btn-primary"},[...t[22]||(t[22]=[J(" Continue to Activities ",-1),e("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1)])])])])}}});export{bt as default};
