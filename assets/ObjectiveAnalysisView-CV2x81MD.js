import{d as Y,u as J,r as d,g as R,i as K,f as Q,n as X,c as l,a as e,j as f,t as n,p,w as Z,v as ee,F as V,l as F,e as D,q as N,o as r,s as se}from"./index-Dch-8Eue.js";import{g as te,u as P,a as ae,b as oe}from"./api-C0GNVXHU.js";import{s as x}from"./text-B6rfVV0Y.js";const ne={class:"animate-fade-in"},ie={key:0,class:"mb-6 p-4 rounded-lg bg-amber-50 border border-amber-200"},le={class:"flex items-start gap-3"},re={class:"text-sm text-amber-700 mt-1"},de={class:"card p-6 mb-6"},ce={class:"grid sm:grid-cols-3 gap-4 mb-6"},ue={class:"font-medium text-surface-900"},ve={class:"font-medium text-surface-900 capitalize"},me={class:"font-medium text-surface-900 capitalize"},be={class:"flex items-center justify-between gap-3 mb-2"},pe=["disabled"],fe={class:"card p-6 mb-6"},xe={class:"flex items-center justify-between mb-6"},ge=["disabled"],ye={key:0,class:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24"},we={key:1,class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},_e={key:0,class:"mb-6 p-4 rounded-lg bg-red-50 border border-red-200 text-red-700 text-sm"},he={key:1,class:"mb-6 p-4 rounded-lg bg-emerald-50 border border-emerald-200 text-emerald-800 text-sm"},ke={key:2,class:"space-y-6 animate-slide-up"},je={class:"bg-brand-50 border border-brand-200 rounded-lg p-4"},Ce={class:"flex items-start gap-3"},Ae={class:"text-sm text-brand-800"},Me={key:0},Ie={class:"space-y-3"},Se={class:"flex items-start justify-between gap-4 mb-2"},Oe={class:"text-sm text-surface-900 font-medium"},Be={class:"flex items-center gap-2 flex-shrink-0"},Le={class:"badge badge-brand"},ze={class:"text-sm text-surface-600"},Te={key:1},Re={class:"space-y-2"},Ve={class:"w-6 h-6 rounded-full bg-emerald-200 text-emerald-700 flex items-center justify-center flex-shrink-0 text-xs font-medium"},Fe={class:"flex-1 min-w-0"},De={class:"text-sm text-emerald-800"},Ne=["onClick"],Pe={key:2,class:"p-4 bg-surface-50 rounded-lg"},He={class:"text-sm text-surface-600"},$e={key:3,class:"text-center py-8 text-surface-500"},Ee={class:"flex justify-between"},Je=Y({__name:"ObjectiveAnalysisView",setup(qe){const j=Q(),o=J(),g=d(!1),y=d(null),c=d(null),C=d(null),S=d(null),b=d(""),i=d(""),_=d(""),O=d(!1),m=d(""),A=d(null),h=d(!1),H=R(()=>i.value.trim().length>0),B=R(()=>(i.value||"")!==(_.value||""));K(async()=>{if(!o.hasActiveSession){j.push("/new-session");return}try{y.value=await te()}catch(t){console.error("Failed to get LLM status:",t)}}),X(()=>o.courseContext.learning_objectives,t=>{const s=t||"";if(!O.value){i.value=s,_.value=s,O.value=!0;return}B.value||(i.value=s)},{immediate:!0});async function $(){var t,s;if(o.sessionId){g.value=!0,b.value="",m.value="";try{o.updateLearningObjectives(i.value);try{await P(o.sessionId,{learning_objectives:i.value}),_.value=i.value}catch(u){console.warn("Failed to persist objectives before analysis:",u)}const a=await ae(o.sessionId,i.value);C.value=a.step_id,S.value=a.recommendation_id,c.value=a.data,o.addDesignStep({id:a.step_id,session_id:o.sessionId,phase:"objective-analysis",user_input:i.value,created_at:new Date().toISOString()})}catch(a){if(console.error("Analysis failed:",a),a&&typeof a=="object"&&"response"in a){const u=a;b.value=((s=(t=u.response)==null?void 0:t.data)==null?void 0:s.detail)||"Analysis failed. Please try again."}else b.value="Analysis failed. Please try again."}finally{g.value=!1}}}function M(){var t,s;return(s=(t=c.value)==null?void 0:t.improved_objectives)!=null&&s.length?c.value.improved_objectives.join(`
`):""}async function L(t,s){const a=x(t);try{await navigator.clipboard.writeText(a),m.value=s}catch(u){console.warn("Failed to copy to clipboard:",u),m.value="Could not access clipboard. Please copy manually."}}async function I(t,s){if(o.updateLearningObjectives(t),o.sessionId){const a=await P(o.sessionId,{learning_objectives:t});_.value=a.learning_objectives??t}if(C.value)try{await oe({step_id:C.value,recommendation_id:S.value??void 0,action_type:"edit",edited_content:t,comment:s})}catch(a){console.warn("Failed to record user action:",a)}}async function E(){if(o.sessionId){h.value=!0,b.value="",m.value="";try{const t=i.value;await I(t,"Saved objectives edits"),m.value="Saved."}catch(t){console.warn("Failed to save objectives:",t),b.value="Save failed. Please try again."}finally{h.value=!1}}}async function q(){var w;const t=M();if(!t)return;const s=x(t),a=i.value.trim(),u=a?`${a}

${s}`:s;i.value=u,m.value="Inserted improved objectives below your original text.",await I(u,"Inserted suggested improved objectives (cleaned markdown)"),await N(),(w=A.value)==null||w.focus()}async function G(){var a;const t=M();if(!t)return;const s=x(t);i.value=s,m.value="Applied improved objectives. You can edit further and re-run analysis.",await I(s,"Replaced objectives with suggested improved objectives (cleaned markdown)"),await N(),(a=A.value)==null||a.focus()}async function U(){const t=M();t&&await L(t,"Copied improved objectives to clipboard (cleaned markdown).")}function W(){o.setCurrentPhase("activity-suggestion"),j.push("/activity-suggestion")}return(t,s)=>{var a,u,w,z,T;return r(),l("div",ne,[s[21]||(s[21]=e("div",{class:"mb-8"},[e("h1",{class:"text-2xl font-bold text-surface-900 mb-2"},"Objective Analysis"),e("p",{class:"text-surface-600"}," Review your learning objectives and get AI-powered analysis and suggestions. ")],-1)),y.value&&!y.value.configured?(r(),l("div",ie,[e("div",le,[s[3]||(s[3]=e("svg",{class:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("div",null,[s[2]||(s[2]=e("div",{class:"font-medium text-amber-800"},"LLM Not Configured",-1)),e("p",re,n(y.value.message),1)])])])):f("",!0),e("div",de,[s[9]||(s[9]=e("h2",{class:"text-sm font-semibold text-surface-500 uppercase tracking-wider mb-4"},"Session Context",-1)),e("div",ce,[e("div",null,[s[4]||(s[4]=e("div",{class:"text-xs text-surface-500 mb-1"},"Course",-1)),e("div",ue,n(p(o).courseContext.course_title),1)]),e("div",null,[s[5]||(s[5]=e("div",{class:"text-xs text-surface-500 mb-1"},"Level",-1)),e("div",ve,n((a=p(o).courseContext.level)==null?void 0:a.replace("-"," ")),1)]),e("div",null,[s[6]||(s[6]=e("div",{class:"text-xs text-surface-500 mb-1"},"Modality",-1)),e("div",me,n((u=p(o).courseContext.modality)==null?void 0:u.replace("-"," ")),1)])]),e("div",null,[e("div",be,[s[7]||(s[7]=e("div",{class:"text-xs text-surface-500"},"Learning Objectives (editable)",-1)),e("button",{class:"btn-secondary",disabled:!p(o).sessionId||h.value||!B.value,onClick:E},[e("span",null,n(h.value?"Saving...":"Save"),1)],8,pe)]),Z(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=v=>i.value=v),ref_key:"objectivesTextarea",ref:A,rows:"6",class:"w-full bg-surface-50 rounded-lg p-4 text-sm text-surface-700 border border-surface-200 focus:outline-none focus:ring-2 focus:ring-brand-200 focus:border-brand-300",placeholder:"Paste or type your learning objectives here (one per line)."},null,512),[[ee,i.value]]),s[8]||(s[8]=e("p",{class:"text-xs text-surface-500 mt-2"}," Tip: after you get “Suggested Improvements”, you can apply them back into this box and re-run analysis. ",-1))])]),e("div",fe,[e("div",xe,[s[12]||(s[12]=e("div",null,[e("h2",{class:"font-semibold text-surface-900"},"AI Objective Analysis"),e("p",{class:"text-sm text-surface-500 mt-1"}," Get feedback on objective clarity, alignment with Bloom's taxonomy, and improvement suggestions. ")],-1)),e("button",{onClick:$,disabled:g.value||!H.value||((w=y.value)==null?void 0:w.configured)===!1,class:"btn-primary"},[g.value?(r(),l("svg",ye,[...s[10]||(s[10]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(r(),l("svg",we,[...s[11]||(s[11]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"},null,-1)])])),e("span",null,n(g.value?"Analyzing...":"Run Objective Analysis (AI)"),1)],8,ge)]),b.value?(r(),l("div",_e,n(b.value),1)):f("",!0),m.value?(r(),l("div",he,n(m.value),1)):f("",!0),c.value?(r(),l("div",ke,[e("div",je,[e("div",Ce,[s[14]||(s[14]=e("div",{class:"w-8 h-8 rounded-full bg-brand-100 text-brand-600 flex items-center justify-center flex-shrink-0"},[e("svg",{class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})])],-1)),e("div",null,[s[13]||(s[13]=e("div",{class:"font-medium text-brand-900 mb-1"},"Overall Assessment",-1)),e("p",Ae,n(p(x)(c.value.overall_assessment||"")),1)])])]),(z=c.value.bloom_analysis)!=null&&z.length?(r(),l("div",Me,[s[15]||(s[15]=e("div",{class:"text-sm font-medium text-surface-700 mb-3"},"Bloom's Taxonomy Analysis",-1)),e("div",Ie,[(r(!0),l(V,null,F(c.value.bloom_analysis,(v,k)=>(r(),l("div",{key:k,class:"p-4 bg-surface-50 rounded-lg"},[e("div",Se,[e("p",Oe,n(v.objective),1),e("div",Be,[e("span",Le,n(v.current_level),1),e("span",{class:se(["badge",v.is_measurable?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"])},n(v.is_measurable?"Measurable":"Not Measurable"),3)])]),e("p",ze,n(p(x)(v.suggestion||"")),1)]))),128))])])):f("",!0),(T=c.value.improved_objectives)!=null&&T.length?(r(),l("div",Te,[e("div",{class:"flex items-center justify-between gap-4 mb-3"},[s[16]||(s[16]=e("div",{class:"text-sm font-medium text-surface-700"},"Suggested Improvements",-1)),e("div",{class:"flex items-center gap-2"},[e("button",{class:"btn-secondary",onClick:U}," Copy "),e("button",{class:"btn-secondary",onClick:q}," Insert below "),e("button",{class:"btn-primary",onClick:G}," Replace (clean) ")])]),e("ul",Re,[(r(!0),l(V,null,F(c.value.improved_objectives,(v,k)=>(r(),l("li",{key:k,class:"flex items-start gap-3 p-3 bg-emerald-50 border border-emerald-200 rounded-lg"},[e("span",Ve,n(k+1),1),e("div",Fe,[e("span",De,n(v),1)]),e("button",{class:"btn-ghost text-sm px-3 py-1.5 flex-shrink-0",onClick:Ge=>L(v,"Copied this suggestion (cleaned markdown)."),title:"Copy this suggestion"}," Copy ",8,Ne)]))),128))])])):f("",!0),c.value.alignment_notes?(r(),l("div",Pe,[s[17]||(s[17]=e("div",{class:"text-sm font-medium text-surface-700 mb-2"},"Alignment Notes",-1)),e("p",He,n(p(x)(c.value.alignment_notes||"")),1)])):f("",!0)])):b.value?f("",!0):(r(),l("div",$e,[...s[18]||(s[18]=[e("svg",{class:"w-12 h-12 mx-auto mb-3 opacity-50",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})],-1),e("p",{class:"text-sm"},'Click "Run Objective Analysis" to get AI-powered feedback.',-1)])]))]),e("div",Ee,[e("button",{onClick:s[1]||(s[1]=v=>p(j).push("/new-session")),class:"btn-secondary"},[...s[19]||(s[19]=[e("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 17l-5-5m0 0l5-5m-5 5h12"})],-1),D(" Back to Context ",-1)])]),e("button",{onClick:W,class:"btn-primary"},[...s[20]||(s[20]=[D(" Continue to Activities ",-1),e("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1)])])])])}}});export{Je as default};
